---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export const prerender = true;

// Get all blog posts and sort by date (newest first)
const posts = (await getCollection('blog'))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const title = 's:CMS Blog';
const description = 'Tutorials, guides, and updates about s:CMS';
---

<BaseLayout title={title} description={description}>
  <main class="container py-5">
    <div class="mb-4">
      <div class="d-flex align-items-center gap-3 mb-4">
        <img 
          src="/images/scms-lad.png" 
          alt="s:CMS Logo" 
          style="width: 4rem; height: 4rem;"
        />
        <h1 class="mb-0">Blog</h1>
      </div>
      <p class="lead">
        Tutorials, guides, and updates about building with s:CMS
      </p>
    </div>

    <div class="mt-5">
      <div class="row g-4">
        {posts.map((post) => (
          <div class="col-12 col-md-6 col-lg-4">
            <article class="card h-100 shadow">
              {post.data.image && (
                <div style="height: 200px; overflow: hidden;">
                  <img 
                    src={post.data.image} 
                    alt={post.data.title}
                    class="card-img-top w-100 h-100"
                    style="object-fit: cover;"
                  />
                </div>
              )}
              
              <div class="card-body d-flex flex-column">
                <div class="flex-grow-1">
                  <a href={`/blog/${post.id}`} class="text-decoration-none">
                    <h5 class="card-title text-dark">
                      {post.data.title}
                    </h5>
                  </a>
                  
                  <p class="card-text text-muted mt-3">
                    {post.data.description}
                  </p>

                  {post.data.tags && post.data.tags.length > 0 && (
                    <div class="mt-3 d-flex flex-wrap gap-2">
                      {post.data.tags.map((tag) => (
                        <span class="badge bg-primary-subtle text-primary-emphasis">
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                </div>

                <div class="mt-3 pt-3 border-top d-flex align-items-center text-muted small">
                  <time datetime={post.data.date.toISOString()}>
                    {post.data.date.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric'
                    })}
                  </time>
                  {post.data.author && (
                    <>
                      <span class="mx-2">Â·</span>
                      <span>{post.data.author}</span>
                    </>
                  )}
                </div>
              </div>
            </article>
          </div>
        ))}
      </div>
    </div>

    {posts.length === 0 && (
      <div class="mt-5 text-center text-muted">
        <p>No blog posts yet. Check back soon!</p>
      </div>
    )}
  </main>
</BaseLayout>
