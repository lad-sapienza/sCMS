---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

// Get all blog posts and sort by date (newest first)
const posts = (await getCollection('blog'))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const title = 's:CMS Blog';
const description = 'Tutorials, guides, and updates about s:CMS';
---

<BaseLayout title={title} description={description}>
  <main class="mx-auto max-w-7xl px-4 py-8">
    <div class="prose max-w-none">
      <div class="flex items-center gap-4 mb-6">
        <img 
          src="/images/scms-lad.png" 
          alt="s:CMS Logo" 
          class="w-16 h-16"
        />
        <h1 class="!mb-0">Blog</h1>
      </div>
      <p class="lead">
        Tutorials, guides, and updates about building with s:CMS
      </p>
    </div>

    <div class="mt-12 grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
      {posts.map((post) => (
        <article class="flex flex-col overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm transition-shadow hover:shadow-md">
          {post.data.image && (
            <div class="aspect-video overflow-hidden bg-gray-100">
              <img 
                src={post.data.image} 
                alt={post.data.title}
                class="h-full w-full object-cover"
              />
            </div>
          )}
          
          <div class="flex flex-1 flex-col p-6">
            <div class="flex-1">
              <a href={`/blog/${post.id}`} class="block">
                <h2 class="text-xl font-semibold text-gray-900 hover:text-blue-600">
                  {post.data.title}
                </h2>
              </a>
              
              <p class="mt-3 text-sm text-gray-600">
                {post.data.description}
              </p>

              {post.data.tags && post.data.tags.length > 0 && (
                <div class="mt-4 flex flex-wrap gap-2">
                  {post.data.tags.map((tag) => (
                    <span class="inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800">
                      {tag}
                    </span>
                  ))}
                </div>
              )}
            </div>

            <div class="mt-6 flex items-center text-sm text-gray-500">
              <time datetime={post.data.date.toISOString()}>
                {post.data.date.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </time>
              {post.data.author && (
                <>
                  <span class="mx-2">Â·</span>
                  <span>{post.data.author}</span>
                </>
              )}
            </div>
          </div>
        </article>
      ))}
    </div>

    {posts.length === 0 && (
      <div class="mt-12 text-center text-gray-500">
        <p>No blog posts yet. Check back soon!</p>
      </div>
    )}
  </main>
</BaseLayout>
